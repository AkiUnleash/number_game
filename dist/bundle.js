(()=>{"use strict";class e{constructor(e,t,n=!0){this.hostElement=document.getElementById(t),this.templateElement=document.getElementById(e);const s=document.importNode(this.templateElement.content,!0);this.element=s.firstElementChild,n&&this.attach()}attach(){this.hostElement.insertAdjacentElement("beforeend",this.element)}}class t{constructor(){this.listeners=[],this.state={question:[],point:0,username:""}}static getInstance(){return t._instance||(t._instance=new t),t._instance}addListener(e){this.listeners.push(e)}setQuestion(){let e=Math.floor(1e5*Math.random()-1).toString().padStart(5,"0");this.state.question=e.toString().split("");for(const e of this.listeners)console.log(this.listeners),e(this.state.question.slice())}getQuestion(){return this.state.question}checkTheAnswer(e){e===this.state.question[0]?(this.state.question.shift(),this.state.point+=10):this.state.point+=-10,0===this.state.question.length&&(this.setQuestion(),this.state.point+=100);for(const e of this.listeners)e(this.state.question.slice(),"question"),e(this.state.point,"point")}setUsername(e){this.state.username=e}getUsername(){return this.state.username}}const n=t.getInstance();class s extends e{constructor(){super("number-button","oparation",!1),this.configure()}configure(){const e=document.getElementById("oparation");let t=document.createDocumentFragment();for(const e of this._arrayshuffle([...Array(10)].map(((e,t)=>t)))){const n=this.element.cloneNode(!0);n.textContent=e.toString(),n.addEventListener("click",(()=>{this._clickHandler(e.toString())})),t.appendChild(n)}e.appendChild(t)}_clickHandler(e){n.checkTheAnswer(e)}_arrayshuffle(e){for(let t=e.length;1<t;t--){const n=Math.floor(Math.random()*t);[e[n],e[t-1]]=[e[t-1],e[n]]}return e}}class i extends e{constructor(){super("question","question_app",!1),this.assignedState=[],n.setQuestion(),n.addListener(((e,t)=>{"question"===t&&(this.assignedState=e,this.elementRemove(),this.renderContent())})),this.renderContent()}configure(){}renderContent(){const e=n.getQuestion(),t=document.getElementById("question_app");let s=document.createDocumentFragment();for(const t of e){const e=this.element.cloneNode(!0);e.textContent=t,s.appendChild(e)}t.appendChild(s)}elementRemove(){document.getElementById("question_app").innerHTML=""}}class o extends e{constructor(){super("game-screen","app")}renderQuestion(){}configure(){}}class r extends e{constructor(){document.getElementById("app").innerHTML="",super("gameover","app")}renderQuestion(){}configure(){}}class c extends e{constructor(e=30){super("timer","timer-screen"),this.count=e,this.renderTimer()}renderTimer(){const e=setInterval((()=>{this.element.textContent=--this.count+" sec",0===this.count&&(clearTimeout(e),new r)}).bind(void 0),1e3)}configure(){}}class a extends e{constructor(){super("point","header"),this._point="",n.addListener(((e,t)=>{"point"===t&&(this._point=e.toString().padStart(5,"0"),this.renderPoint())}))}renderPoint(){this.element.textContent=this._point.toString()}configure(){}}class u extends e{constructor(){super("username","header"),this.element.textContent=n.getUsername()}renderQuestion(){}configure(){}}class h extends e{constructor(e=3){super("standby","app"),this._count=e,this.configure()}configure(){return e=this,t=void 0,s=function*(){let e=yield this._countDown(this._count);this.element.textContent=e.toString(),e=yield this._countDown(e),this.element.textContent=e.toString(),e=yield this._countDown(e),this._gameScreenShow()},new((n=void 0)||(n=Promise))((function(i,o){function r(e){try{a(s.next(e))}catch(e){o(e)}}function c(e){try{a(s.throw(e))}catch(e){o(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,c)}a((s=s.apply(e,t||[])).next())}));var e,t,n,s}_countDown(e){return new Promise((t=>{setTimeout((function(){t(--e)}),1e3)}))}_gameScreenShow(){this.element.remove(),new o,new u,new a,new i,new s,new c}}new class extends e{constructor(){super("start-button","app"),this.elementStart=this.element.querySelector("#start"),this.elementUsername=this.element.querySelector("#name_field"),this.configure()}configure(){this.elementStart.addEventListener("click",this.clickHandler.bind(this))}clickHandler(e){n.setUsername(this.elementUsername.value),this.element.remove(),new h}getUsername(){}}})();